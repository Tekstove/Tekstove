<VirtualHost *:80>
  ServerName tekstove.info
  ServerAlias www.tekstove.info
  DocumentRoot /var/www/tekstove-site/stable/web

    ProxyPass /proxy/api/ http://api.tekstove.fb/
    ProxyPassReverse /proxy/api/ http://api.tekstove.fb:80/

    RewriteEngine on
    Options +FollowSymlinks

    RewriteCond %{HTTP_HOST} ^www\.tekstove\.info$ [NC]
    RewriteRule (.*) http://tekstove.info$1 [L,R=301]

    # lyric redirect
    RewriteCond %{QUERY_STRING} ^.*id=([0-9]+).*$
    RewriteRule browse\.php /lyric/view/%1? [L,R=301]                                                                                                

    # album redirect                                                                                                                                 
    RewriteCond %{QUERY_STRING} id=([0-9]+)$                                                                                                         
    RewriteRule albumvij\.php /album/view/%1? [L,R=301]                                                                                              

    # user profile redirect                                                                                                                          
    RewriteCond %{QUERY_STRING} profile=([0-9]+)$                                                                                                    
    RewriteRule profile\.php /user/view/%1? [L,R=301]                                                                                                

    # forum
    RewriteRule forum\.php /forum/category/list [L,R=301]

    # forum category
    RewriteCond %{QUERY_STRING} razdel=([0-9]+)$
    RewriteRule forum_razdel_vij\.php /forum/category/%1/topics? [L,R=301]

    # forum topic
    RewriteCond %{QUERY_STRING} id=([0-9]+)$
    RewriteRule forum_topic_vij\.php /forum/topic/%1? [L,R=301]

    # chat
    RewriteRule _chat /chat [L,R=301]

    # contacts
    RewriteRule contact\.php /contacts [L,R=301]

    # forum new posts
    RewriteRule forum_novi_mneniq\.php /forum/post/newest [L,R=301]

    #artist browse
    RewriteCond %{QUERY_STRING} id=([0-9]+)$
    RewriteRule browsepoartist\.php /artist/browse/%1? [L,R=301]

    # search
    RewriteRule search\.php /lyric/search [L,R=301]


    <Directory /var/www/tekstove-site/stable/web>
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_URI} !^/proxy/
            RewriteRule ^ /app.php [QSA,L]
    </Directory>


    SuexecUserGroup tekstove-site tekstove-site
    <Directory /var/www/tekstove-site/stable>                                                                                                                                
        Options +ExecCGI                                                                                                                                           
        AllowOverride None                                                                                                                                         
        AddHandler fcgid-script .php
        FCGIWrapper /var/www/php-fcgi-scripts/tekstove-site/php-fcgi-starater .php
    </Directory>

    <filesmatch "\.(ico|css|gif|jpg|png)$">
            Header set Cache-Control "max-age=34560000, public"
    </filesmatch>

    <Directory /var/www/tekstove>                                                                                                                                
      Options +ExecCGI                                                                                                                                           
      AllowOverride None                                                                                                                                         
      AddHandler fcgid-script .php
      FCGIWrapper /var/www/php-fcgi-scripts/tekstove/php-fcg-starter .php
      Order allow,deny
        Allow from all
        #deny from 127.0
        #deny from 95.70
    </Directory>


    SetEnvIf Request_URI "\.(gif|css|jpg|png|js|ico|js)$" dontlog


    ErrorLog /var/log/apache2/tekstove/error.log
    CustomLog /var/log/apache2/tekstove/access.log combined env=!dontlog
    ServerSignature Off

</VirtualHost>
