{% extends 'SiteBundle::main.html.twig' %}

{% block title %}
    {{ lyric.cacheTitleShort|e }} |
    текст
    {% if (lyric.getTextBg) %}
    и превод
    {% endif %}
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-6" id="lyric-stats">
            гледания: {{ lyric.views }}, популярност: {{ lyric.popularity }}
        </div>
    </div>

    <div class="row">
        <div class="col-md-10">
            <h1>
                {% include '@TekstoveSite/partial/artistList.html.twig' with {'artists': lyric.artists} only %}

                {% if lyric.artists is not empty %}
                    - 
                {% endif %}
                {{ lyric.title }}
            </h1>
        </div>
            <div class="col-md-2">
                {% if (lyric.isEditAllowed) %}
                    <a class="btn btn-warning" href="{{ path('lyricEdit', {id:lyric.id}) }}">Промени</a>
                {% endif %}
            </div>
    </div>
            
{% if lyric.hasVideo %}
    <div class="row" id="tabs">
        <ul>
{% if lyric.videoYoutube is not empty %}
            <li>
                <a href="#lyric-video-youtube">
                    YouTube
                </a>
            </li>
{% endif %}
{% if lyric.videoVbox7 is not empty %}
            <li>
                <a href="#lyric-video-vbox7">
                    Vbox7
                </a>
            </li>
{% endif %}

        </ul>
{% if lyric.videoVbox7 is not empty %}
        <div id="lyric-video-vbox7">
            <div class="row">
                <script>
                    document.write(videoVbox('{{ lyric.videoVbox7|e('js') }}'));
                </script>
            </div>
        </div>
{% endif %}

{% if lyric.videoYoutube is not empty %}
        <div id="lyric-video-youtube">
            <div class="row">
                <script>
                    document.write(videoYouTube('{{ lyric.videoYoutube|e('js') }}'));
                </script>
            </div>
        </div>
{% endif %}
    </div>
{% endif %}

    <script>
        $(function(){
            $("#tabs").tabs();
        });
    </script>

    <div class="row">
        {% if (lyric.sendByUser) %}
            <div style="float:left;">
                изпратено от:
                <b>
                    <a href="{{ path('userView', { id:lyric.sendByUser.id }) }}">
                        {{ lyric.sendByUser.username }}
                    </a>
                </b> 
            </div>
        {% endif %}
    </div>

    <div class="row">
        {% if lyric.languages is not empty %}
            езици:
            {% for language in lyric.languages %}
                {{ language.name }}
                {% if not loop.last %}
                    ,
                {% endif %}
            {% endfor %}
        {% endif %}
    </div>

    {% if lyric.extraInfoHtml is not empty %}
        <div class="panel panel-default">
            <div class="panel-heading">Допълнителна информация</div>
            <div class="panel-body">
                {{ lyric.extraInfoHtml|raw }}
            </div>
        </div>
    {% endif %}

    {% include '@TekstoveSite/Ads/lyric.view.above-text.html.twig' %}
    
    <br/>
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-body">
                    {{ lyric.text|e|nl2br }}
                </div>
            </div>
        </div>
{% if (lyric.getTextBg) %}
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-body">
                    {{ lyric.textBg|e|nl2br }}
                </div>
            </div>
        </div>
{% endif %}
    </div>

    <script>
        $.ajax({
            url: '{{ apiUrl|e('js') }}/v4/lyrics/{{ lyric.id }}?groups%5B0%5D=Details',
        }).done(function(data) {
            var sendDate = new Date(data.item.sendDate * 1000);
            var sendText = ", изпратена на " + sendDate.getDate() + ".";
            sendText += sendDate.getMonth() + "." + sendDate.getFullYear();
            $('#lyric-stats').append(sendText);
        });
    </script>
{% endblock %}
